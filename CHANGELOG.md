# 更新日誌

## 版本 3.0.0 - 2026-01-04

### 🎨 重大新增：圖表視覺化功能

#### 總損益趨勢圖 ✅
- 點擊總損益卡片即可展開/收合圖表
- 顯示所有持股的總損益隨時間變化
- 藍色曲線清晰呈現損益波動
- 互動式 Tooltip 顯示精確時間和損益金額
- 自動記錄歷史數據（每分鐘一次，保留最近 100 筆）

#### 個股損益曲線圖 ✅
- 每檔股票都有獨立的圖表按鈕（📈/📊）
- 點擊按鈕展開/收合該股票的損益曲線
- 圖表顏色與損益狀態同步（紅漲綠跌）
- Tooltip 同時顯示損益和股價
- 歷史數據獨立記錄並同步至雲端

#### 技術實現
- 使用 **Recharts** 圖表庫
- 響應式設計，適配所有裝置
- 深色主題與 APP 風格一致
- 自訂 Tooltip 組件
- 自動清理超過 100 筆的舊記錄
- 歷史數據同步至 Firestore

### 資料結構更新

新增以下欄位至 Firestore：
- `totalHistory`: 總損益歷史記錄陣列
- `stocks[i].history`: 個股損益歷史記錄陣列

每筆歷史記錄包含：
- `time`: ISO 8601 時間戳記
- `profit`: 損益金額
- `price`: 股價（僅個股記錄）

---

## 版本 2.0.0 - 2026-01-04

### 新增功能

#### 1. 股票名稱顯示 ✅
- 自動透過 Fugle API 查詢股票中文名稱
- 在股票代碼旁顯示公司名稱（例如：2330 台積電）
- 首次載入時自動抓取所有持股的名稱

#### 2. 編輯功能 ✅
- 每張股票卡片新增「編輯」按鈕
- 可直接修改買價和張數
- 編輯時顯示儲存（✓）和取消（✕）按鈕
- 修改後自動重新計算損益並同步至雲端

#### 3. 排序功能 ✅
- 新增排序下拉選單，支援四種排序方式：
  - **依時間排序**：按新增順序（預設）
  - **依損益排序**：由高到低排列
  - **依報酬率排序**：由高到低排列
  - **依代碼排序**：按股票代碼字母順序

#### 4. 錯誤處理與載入狀態 ✅
- **載入畫面**：首次開啟時顯示旋轉載入動畫
- **錯誤提示**：WebSocket 斷線或同步失敗時顯示紅色警告橫幅
- **可關閉錯誤**：點擊 ✕ 按鈕可關閉錯誤提示
- **友善錯誤訊息**：顯示具體的錯誤原因

#### 5. 手續費折數自訂 ✅
- 新增「⚙️ 設定」按鈕
- 可自訂券商折數（預設 23 折）
- 可自訂最低手續費（預設 20 元）
- 設定會同步至雲端，所有裝置共用

#### 6. 損益高低點追蹤 ✅
- **即時追蹤**：每檔股票自動記錄最高和最低損益點
- **時間戳記**：記錄達到高低點的精確時間
- **視覺化顯示**：
  - 📈 最高損益（紅色）
  - 📉 最低損益（綠色）
- **格式化時間**：顯示為「月/日 時:分」格式

### 技術改進

- 優化資料結構：新增 `highPoint` 和 `lowPoint` 欄位
- 改進 WebSocket 錯誤處理機制
- 新增 CSS 動畫支援（載入旋轉動畫）
- 設定資料與股票資料分離儲存
- 使用 Firestore merge 模式避免覆蓋資料

### 使用者介面優化

- 新增設定面板（可展開/收合）
- 改進按鈕佈局（編輯和刪除並排）
- 新增高低點資訊區塊（深色背景區分）
- 優化錯誤提示樣式（紅色橫幅 + 關閉按鈕）
- 改進載入畫面視覺效果

---

## 版本 1.0.0 - 初始版本

### 核心功能

- 即時報價追蹤（Fugle WebSocket）
- 智能損益計算（含手續費、證交稅）
- 雲端同步（Firebase Firestore）
- 快速輸入介面
- 深色主題設計
