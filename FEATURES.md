# 未實現損益 APP - 功能說明

## 📱 核心功能

### 即時報價追蹤
透過 Fugle API WebSocket 串流技術，您的持股價格會即時更新，無需手動重新整理。每檔股票的現價會以醒目的藍色字體顯示，讓您隨時掌握市場動態。

### 智能損益計算
系統會自動計算每筆交易的完整成本，包含買入手續費、賣出手續費以及證交稅（現沖減半）。計算結果包括淨損益金額、報酬率百分比、保本價格以及需要上漲的跳檔數，讓您清楚了解每個部位的獲利狀況。

### 雲端同步機制
所有資料透過 Firebase Firestore 即時同步至雲端。無論您使用手機、平板或電腦，只要開啟網頁就能看到最新的持股資料。新增或刪除部位時，所有裝置會立即更新，不會有資料不一致的問題。

---

## 🆕 新增功能（v2.0）

### 1. 股票名稱顯示
系統會自動查詢並顯示每檔股票的中文名稱。當您輸入股票代碼後，APP 會透過 Fugle API 取得公司名稱，並顯示在代碼旁邊。例如輸入「2330」後，畫面會顯示「2330 台積電」，讓您更容易識別持股。

**使用方式**：首次新增股票時，名稱會在幾秒內自動載入。如果 API 查詢失敗，則僅顯示股票代碼。

---

### 2. 編輯功能
發現輸入錯誤或需要調整成本時，不需要刪除重新輸入。每張股票卡片右下角都有「編輯」按鈕，點擊後可以直接修改買價和張數。

**使用方式**：
1. 點擊股票卡片右下角的「編輯」按鈕
2. 在彈出的輸入框中修改買價或張數
3. 點擊綠色的「✓」按鈕儲存，或點擊紅色的「✕」按鈕取消

修改後系統會立即重新計算損益，並同步至雲端。

---

### 3. 排序功能
當持股數量增加時，您可能需要依照不同條件排序來快速找到特定股票或檢視獲利狀況。APP 提供四種排序方式。

**排序選項**：
- **依時間排序**：按照新增順序顯示（預設）
- **依損益排序**：獲利最高的排在最上面
- **依報酬率排序**：報酬率最高的排在最上面
- **依代碼排序**：按照股票代碼字母順序排列

**使用方式**：點擊輸入框下方的排序下拉選單，選擇您想要的排序方式。排序會立即生效，但不會影響雲端儲存的順序。

---

### 4. 錯誤處理與載入狀態
為了提供更好的使用體驗，系統現在會明確告知您目前的狀態。

**載入畫面**：首次開啟 APP 或重新載入時，會顯示旋轉的載入動畫和「載入中...」文字，讓您知道系統正在從雲端取得資料。

**錯誤提示**：當發生錯誤時（例如網路斷線、API 失敗、同步失敗），畫面頂端會顯示紅色的警告橫幅，說明具體的錯誤原因。您可以點擊右側的「✕」按鈕關閉提示。

常見錯誤訊息：
- 「雲端同步失敗」：Firebase 連線問題
- 「股票 XXXX 報價連線失敗」：Fugle WebSocket 連線問題

---

### 5. 手續費折數自訂
不同券商提供的手續費折扣不同，您可以根據自己的券商設定正確的折數，讓損益計算更精準。

**使用方式**：
1. 點擊輸入框下方的「⚙️ 設定」按鈕
2. 在展開的設定面板中調整以下參數：
   - **券商折數**：輸入您的券商提供的折數（例如 23 折輸入「23」）
   - **最低手續費**：輸入券商的最低手續費標準（通常為 20 元或 1 元）
3. 點擊「儲存」按鈕確認變更

設定會立即生效並同步至雲端，所有裝置都會使用相同的設定。點擊「取消」按鈕可以放棄變更。

**預設值**：
- 券商折數：23 折（華南永昌標準）
- 最低手續費：20 元

---

### 6. 損益高低點追蹤
系統會自動記錄每檔股票在本次開啟後達到的最高和最低損益點，幫助您了解價格波動範圍。

**顯示內容**：
- 📈 **最高損益**：顯示為紅色，包含金額和達到時間
- 📉 **最低損益**：顯示為綠色，包含金額和達到時間

**時間格式**：月/日 時:分（例如「01/04 14:30」）

**注意事項**：
- 高低點記錄僅追蹤本次開啟 APP 後的資料
- 關閉 APP 後重新開啟，高低點會重置為當前損益
- 未來版本將支援歷史極值的永久記錄

**使用情境**：當您看到某檔股票曾經達到很高的獲利但現在回落時，可以參考最高點的時間，判斷是否要調整操作策略。

---

## 📝 基本操作

### 新增持股
在輸入框中輸入「股號 買價 張數」，按下 Enter 鍵即可新增。例如輸入「2330 580 2」代表以 580 元買入 2 張台積電。

如果輸入相同的股票代碼，系統會自動合併並計算加權平均成本。

### 刪除持股
點擊股票卡片右下角的「刪除」按鈕，確認後即可移除該部位。刪除操作會立即同步至雲端。

### 查看總損益
畫面頂端的大型數字顯示所有持股的總損益。紅色代表獲利，綠色代表虧損。

---

## 🔒 安全性提醒

目前 APP 的 Firebase 和 Fugle API 金鑰是直接寫在前端代碼中的。雖然這對個人使用沒有太大問題，但建議未來將這些敏感資訊移至環境變數或後端服務，以提升安全性。

Firestore 資料庫的安全規則也需要正確設定，確保只有您能存取自己的資料。

---

## 🚀 未來規劃

以下功能正在規劃中，將在後續版本推出：

- **歷史紀錄**：記錄每次買賣的完整歷史，可查看過去的交易和損益變化
- **匯出功能**：將持股資料匯出為 CSV 或 Excel 檔案
- **圖表視覺化**：顯示損益趨勢圖表，更直觀地了解績效
- **價格警示**：設定目標價格，達到時推播通知
- **多帳戶管理**：支援管理多個交易帳戶
- **使用者認證**：加入登入機制，保護個人資料

---

## 💡 使用技巧

1. **善用排序功能**：當持股較多時，依損益排序可以快速找出表現最好和最差的股票
2. **定期檢查設定**：更換券商時記得更新手續費折數，確保計算準確
3. **關注高低點**：如果某檔股票的最高點遠高於當前損益，可能是賣出時機的參考
4. **保持網路連線**：WebSocket 需要穩定的網路才能即時更新報價
5. **跨裝置使用**：雲端同步功能讓您可以在任何裝置上查看和管理持股

---

## 📞 問題回報

如果您在使用過程中遇到任何問題或有功能建議，歡迎透過 GitHub Issues 回報。
